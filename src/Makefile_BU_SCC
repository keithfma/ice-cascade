# Customized for the BU Shared Computing Cluster
# 
# Required modules:
#		netcdf/4.3.0
#		netcdf-fortran/4.4.2
#		fftw/3.3.4
#
# Uses system default compiler and MPI distribution, which are:
# 	GCC v.4.4.7
# 	OpenMPI v1.6.4
#
# Other library paths are defined explicitly (not using modules) 

NETCDF_INC = $(SCC_NETCDF_INCLUDE)
NETCDF_LIB = $(SCC_NETCDF_LIB)
NETCDFF_INC = $(SCC_NETCDF_FORTRAN_INCLUDE)
NETCDFF_LIB = $(SCC_NETCDF_FORTRAN_LIB)
FFTW3_INC = $(SCC_FFTW_INCLUDE)
FFTW3_LIB = $(SCC_FFTW_LIB)

FORT = mpif90
FFLAGS = -c -ffree-line-length-none -g
LDFLAGS = -Wl,-rpath,$(NETCDF_LIB),-rpath,$(NETCDFF_LIB),-rpath,$(FFTW3_LIB),--enable-new-dtags
DEFS = 
INCL = -I. -I$(NETCDF_INC) -I$(NETCDFF_INC) -I$(FFTW3_INC) 
LIBS = -L$(FFTW3_LIB) -lfftw3 -L$(NETCDF_LIB) -lnetcdf -L$(NETCDFF_LIB) -lnetcdff

SRC = \
types.f90 \
fftw3.f90 \
benchmark.f90 \
cascade.f90 \
ice.f90 \
io.f90 \
hillslope.f90 \
flexure.f90 \
uplift.f90 \
ice_cascade.f90 \

OBJ = $(patsubst %.f90, %.o, $(SRC))

ice_cascade: $(OBJ)
	$(FORT) $(LIBS) $(LDFLAGS) $^ -o ../ice-cascade

%.o %.mod: %.f90 	
	$(FORT) $(FFLAGS) $(DEFS) $(INCL) $< -o $@ 

.PHONY: clean	

clean:
	rm -f *.o *.mod ../ice-cascade
